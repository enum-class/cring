name: Tests
on: [push, pull_request]

jobs:
    appleclang:
        strategy:
            matrix:
                macos: [11, 12, 13]
                build_type: [Release, Debug]
            fail-fast: false
        name: "AppleClang (MacOS ${{ matrix.macos }}, ${{ matrix.build_type }})"
        runs-on: macos-${{ matrix.macos }}
        steps:
            - uses: actions/checkout@v2
            - run: cc -v
            - run: cmake -B ${{ matrix.build_type }} -DCRING_BENCHMARK=ON -DCRING_TESTS=ON -DCRING_EXAMPLES=ON .
            - run: cmake --build ${{ matrix.build_type }}
            - run: ./${{ matrix.build_type }}/tests/run_test
    gcc:
        strategy:
            matrix:
                gcc: [8, 9, 10, 11, 13]
                build_type: [Release, Debug]
            fail-fast: false
        name: "GCC ${{ matrix.gcc }}, ${{ matrix.build_type }}"
        runs-on: ubuntu-22.04
        steps:
            - name: "Install GCC"
              uses: egor-tensin/setup-gcc@v1
              with:
                version: ${{ matrix.gcc }}
            - uses: actions/checkout@v2
            - run: cc -v
            - run: cmake -B ${{ matrix.build_type }} -DCRING_BENCHMARK=ON -DCRING_TESTS=ON -DCRING_EXAMPLES=ON .
            - run: cmake --build ${{ matrix.build_type }}
            - run: ./${{ matrix.build_type }}/tests/run_test
    clang:
        strategy:
            matrix:
                clang: [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
                build_type: [Release, Debug]
            fail-fast: false
        name: "Clang ${{ matrix.clang }}, ${{ matrix.build_type }}"
        runs-on: ubuntu-22.04
        steps:
            - name: "Install Clang"
              uses: egor-tensin/setup-clang@v1
              with:
                version: ${{ matrix.clang }}
            - uses: actions/checkout@v2
            - run: cc -v
            - run: cmake -B ${{ matrix.build_type }} -DCRING_BENCHMARK=ON -DCRING_TESTS=ON -DCRING_EXAMPLES=ON .
            - run: cmake --build ${{ matrix.build_type }}
            - run: ./${{ matrix.build_type }}/tests/run_test
    clang-format-check:
        runs-on: ubuntu-22.04
        steps:
            - name: "Install clang-format"
              run: sudo apt-get install -y clang-format
            - uses: actions/checkout@v2
            - run: find . -regex '.*\.\(c\|cpp\|cxx\|h\|hpp\|hxx\)$' -exec clang-format --dry-run --Werror '{}'